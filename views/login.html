<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Chat app - Login</title>


<link rel="stylesheet" href="/css/style.css">

</head>

<body>

<div class="container">

  <div class="card">

    <div class="card-header">
      Chat app
    </div>

    <div class="card-body">

      <form id="loginForm">

        <div class="form-group">
          <label>Username</label>
          <input name="username" placeholder="username" required>
        </div>

        <div class="form-group">
          <label>Password</label>
          <input name="password" type="password" placeholder="password" required>
        </div>

        <button type="submit" class="btn">
          Login
        </button>

      </form>

      <p id="msg" class="msg"></p>

      <a href="/signup" class="link">
        Create account
      </a>

    </div>

  </div>

</div>

<script>

const existing = localStorage.getItem("user");

if (existing){
  window.location.href = "/rooms";
}

document.getElementById("loginForm")
.addEventListener("submit", async (e)=>{

  e.preventDefault();

  const form = new FormData(e.target);

  const body = Object.fromEntries(form.entries());

  const res = await fetch("/api/login",{

    method:"POST",

    headers:{
      "Content-Type":"application/json"
    },

    body:JSON.stringify(body)

  });

  const data = await res.json();

  document.getElementById("msg").innerText =
    data.message || "";

  if(res.ok){

    localStorage.setItem(
      "user",
      JSON.stringify(data.user)
    );

    window.location.href="/rooms";
  }
  localStorage.removeItem("activeUsername");
  localStorage.removeItem("room");


});

</script>

</body>
</html>
